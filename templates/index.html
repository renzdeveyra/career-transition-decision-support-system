<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Career Transition Decision Support System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <style>
      body {
        padding-top: 2rem;
        padding-bottom: 2rem;
      }
      .form-section {
        margin-bottom: 2rem;
      }
      /* Additional styles will be added in the results section */
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="mb-4">Career Transition Decision Support System</h1>
      <p class="lead">
        Enter your information below to receive personalized career transition
        advice.
      </p>

      <form id="career-form" class="needs-validation" novalidate>
        <div class="form-section">
          <h3>Personal Information</h3>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="age" class="form-label">Age</label>
              <input
                type="number"
                class="form-control"
                id="age"
                name="age"
                required
                min="18"
                max="65"
              />
            </div>
            <div class="col-md-6">
              <label for="has_degree" class="form-label"
                >Do you have a college degree?</label
              >
              <select
                class="form-select"
                id="has_degree"
                name="has_degree"
                required
              >
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Career Information</h3>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="bpo_experience_years" class="form-label"
                >Years of BPO Experience</label
              >
              <input
                type="number"
                class="form-control"
                id="bpo_experience_years"
                name="bpo_experience_years"
                required
                step="0.5"
                min="0"
                max="30"
              />
            </div>
            <div class="col-md-6">
              <label for="current_salary" class="form-label"
                >Current Monthly Salary (PHP)</label
              >
              <input
                type="number"
                class="form-control"
                id="current_salary"
                name="current_salary"
                required
                min="10000"
                max="200000"
              />
            </div>
            <div class="col-md-6">
              <label for="bpo_satisfaction" class="form-label"
                >Satisfaction with BPO Career (1-10)</label
              >
              <input
                type="range"
                class="form-range"
                id="bpo_satisfaction"
                name="bpo_satisfaction"
                min="1"
                max="10"
                value="5"
              />
              <div class="d-flex justify-content-between">
                <span>Very Dissatisfied</span>
                <span>Very Satisfied</span>
              </div>
            </div>
            <div class="col-md-6">
              <label for="performance_level" class="form-label"
                >Performance Level</label
              >
              <select
                class="form-select"
                id="performance_level"
                name="performance_level"
                required
              >
                <option value="poor">Poor</option>
                <option value="average">Average</option>
                <option value="good" selected>Good</option>
                <option value="excellent">Excellent</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Preferences</h3>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label"
                >Interests (select all that apply)</label
              >
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="interests"
                  value="technology"
                  id="interest_technology"
                />
                <label class="form-check-label" for="interest_technology"
                  >Technology</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="interests"
                  value="leadership"
                  id="interest_leadership"
                />
                <label class="form-check-label" for="interest_leadership"
                  >Leadership</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="interests"
                  value="business"
                  id="interest_business"
                />
                <label class="form-check-label" for="interest_business"
                  >Business</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="interests"
                  value="creative"
                  id="interest_creative"
                />
                <label class="form-check-label" for="interest_creative"
                  >Creative</label
                >
              </div>
            </div>
            <div class="col-md-6">
              <label for="financial_pressure" class="form-label"
                >Financial Pressure</label
              >
              <select
                class="form-select"
                id="financial_pressure"
                name="financial_pressure"
                required
              >
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
          </div>
        </div>

        <div class="d-grid gap-2 mt-4">
          <button class="btn btn-primary" type="submit">
            Get Career Recommendation
          </button>
        </div>
      </form>

      <div id="results" class="mt-5 d-none">
        <h2>Your Career Recommendation</h2>
        <div class="card mb-4">
          <div class="card-body">
            <h3 id="recommendation-title" class="card-title"></h3>
            <div
              id="recommendation-explanation"
              class="recommendation-content"
            ></div>
          </div>
        </div>

        <div id="visualization-container" class="mb-4">
          <h3>Career Path Comparison</h3>
          <img
            id="visualization"
            class="img-fluid"
            alt="Career path visualization"
          />
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      document
        .getElementById("career-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const formData = new FormData(this);

          fetch("/analyze", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              // Display results
              document.getElementById("results").classList.remove("d-none");

              // Update recommendation title
              document.getElementById("recommendation-title").textContent =
                data.recommendation
                  ? data.recommendation.name
                  : "No specific recommendation";

              // Format and display explanation using marked.js to convert markdown to HTML
              const explanationHtml = marked.parse(data.explanation);

              // Apply custom formatting to the HTML
              let formattedHtml =
                explanationHtml
                  // Wrap sections in div with class
                  .replace(
                    /<h2>(.*?)<\/h2>/g,
                    '<div class="recommendation-section"><h2>$1</h2>'
                  )
                  .replace(
                    /<h2>/g,
                    '</div><div class="recommendation-section"><h2>'
                  ) + "</div>";

              // Remove the first empty div
              formattedHtml = formattedHtml.replace("<div></div>", "");

              // Format pros and cons section
              formattedHtml = formattedHtml.replace(
                /<h3>Pros<\/h3>\s*<ul>([\s\S]*?)<\/ul>\s*<h3>Cons<\/h3>\s*<ul>([\s\S]*?)<\/ul>/g,
                '<div class="pros-cons-container"><div class="pros-container"><h3>Pros</h3><ul>$1</ul></div><div class="cons-container"><h3>Cons</h3><ul>$2</ul></div></div>'
              );

              // Add icons to next steps
              formattedHtml = formattedHtml.replace(
                /<li>([^<]*)<\/li>/g,
                '<li class="next-steps-item"><i class="bi bi-check-circle-fill"></i>$1</li>'
              );

              // Add confidence indicator styling
              formattedHtml = formattedHtml
                .replace(
                  /Confidence level: <strong>(High|Medium|Low)<\/strong>/g,
                  'Confidence level: <span class="confidence-indicator confidence-$1">$1</span>'
                )
                .replace(/confidence-High/g, "confidence-high")
                .replace(/confidence-Medium/g, "confidence-medium")
                .replace(/confidence-Low/g, "confidence-low");

              document.getElementById("recommendation-explanation").innerHTML =
                formattedHtml;

              // Update visualization if available
              if (data.visualization) {
                document.getElementById("visualization").src =
                  "data:image/png;base64," + data.visualization;
                document
                  .getElementById("visualization-container")
                  .classList.remove("d-none");
              } else {
                document
                  .getElementById("visualization-container")
                  .classList.add("d-none");
              }

              // Scroll to results
              document
                .getElementById("results")
                .scrollIntoView({ behavior: "smooth" });
            })
            .catch((error) => {
              console.error("Error:", error);
              alert(
                "An error occurred while processing your request. Please try again."
              );
            });
        });
    </script>
  </body>
</html>
